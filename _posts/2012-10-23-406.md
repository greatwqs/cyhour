---
title: WordPress 读者墙（留言板）页面模板
author: 老杨
layout: post
permalink: /406.html
categories:
  - 信息技术
tags:
  - 读者墙
---
下面是实现方法和代码。  


  
复制一份主题的 page.php 更名为 Readers.php，然后在最顶端加入模板名称代码。

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444"><span style="color:#555">&lt;?php</span><br /><span style="color:#a50">/*</span><br /><span style="color:#a50">Template Name: Readers</span><br /><span style="color:#a50">*/</span><br /><span style="color:#555">?&gt;</span></pre>

在 Readers.php 找到<span style = "color:red;">类似如下的代码</span>

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444"><span style="color:#555">&lt;?php</span> <span style="color:#@cm-word">content</span>(); <span style="color:#555">?&gt;</span></pre>

在其下面加入如下代码：

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444"><span style="color:#a50">&lt;!-- start 读者墙 --&gt;</span><br />		<span style="color:#555">&lt;?php</span>  <br />			<span style="color:#000-2">$identity</span><span style="color:#000">=</span><span style="color:#a11">"comment_author"</span>;<br />			<span style="color:#000-2">$passwordpost</span> <span style="color:#000">=</span> <span style="color:#a11">" AND post_password=''"</span>;<br />			<span style="color:#000-2">$userexclude</span> <span style="color:#000">=</span> <span style="color:#a11">" AND user_id='0'"</span>;<br />			<span style="color:#000-2">$approved</span> <span style="color:#000">=</span> <span style="color:#a11">" AND comment_approved='1'"</span>;<br />			<span style="color:#000-2">$pinged</span> <span style="color:#000">=</span> <span style="color:#a11">" AND comment_type not in ('trackback','pingback')"</span>;<br />			<span style="color:#a50">//ORDER BY cnt DESC,comment_date_gmt DESC  按评论数量 时间降序</span><br />			<span style="color:#000-2">$shownumber</span> <span style="color:#000">=</span> <span style="color:#164">72</span>;<span style="color:#a50">//表示在页面显示的数量</span><br />			<span style="color:#000-2">$counts</span> <span style="color:#000">=</span> <span style="color:#000-2">$wpdb</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">get_results</span>(<span style="color:#a11">"SELECT COUNT("</span> . <span style="color:#000-2">$identity</span> . <span style="color:#a11">") AS cnt, comment_author, comment_author_url,comment_author_email</span><br />			<span style="color:#a11">FROM (SELECT * FROM $wpdb-&gt;comments LEFT OUTER JOIN $wpdb-&gt;posts</span><br />			<span style="color:#a11">ON ($wpdb-&gt;posts.ID=$wpdb-&gt;comments.comment_post_ID)</span><br />			<span style="color:#a11">WHERE YEAR(comment_date)=YEAR(now())"</span> .<br />			<span style="color:#000-2">$userexclude</span> . <span style="color:#000-2">$passwordpost</span> . <span style="color:#000-2">$approved</span> .<span style="color:#000-2">$pinged</span>. <span style="color:#a11">") AS tempcmt</span><br />			<span style="color:#a11">GROUP BY "</span> . <span style="color:#000-2">$identity</span> . <span style="color:#a11">" ORDER BY cnt DESC,comment_date_gmt DESC LIMIT "</span> . <span style="color:#000-2">$shownumber</span>); <br />		<span style="color:#555">?&gt;</span> <br />		<span style="color:#170">&lt;div</span> <span style="color:#00c">class</span>=<span style="color:#a11">"readers"</span><span style="color:#170">&gt;</span><span style="color:#a50">&lt;!-- 读者墙 --&gt;</span><br />			<span style="color:#555">&lt;?php</span> <br />				<span style="color:#708">if</span> ( <span style="color:#000-2">$counts</span> ) : <span style="color:#708">foreach</span> (<span style="color:#000-2">$counts</span> <span style="color:#708">as</span> <span style="color:#000-2">$count</span>) :<br />    				<span style="color:#708">if</span> ( <span style="color:#708">empty</span>( <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author_url</span> ) <span style="color:#000">||</span> <span style="color:#a11">'http://'</span> <span style="color:#000">==</span> <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author_url</span> ) <br />    					<span style="color:#708">echo</span>  <span style="color:#a11">'&lt;li&gt;&lt;a href="/" target="_blank" rel="external nofollow" title="'</span> . <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author</span> . <span style="color:#a11">' ('</span>. <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">cnt</span> . <span style="color:#a11">'条评论)"&gt;'</span>.<span style="color:#@cm-word">get_avatar</span>( <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author_email</span>, <span style="color:#164">40</span> ) .  <span style="color:#a11">' &lt;/a&gt;&lt;/li&gt;'</span>;<br />    				<span style="color:#708">else</span><br />						<span style="color:#708">echo</span>  <span style="color:#a11">'&lt;li&gt;&lt;a href="'</span>. <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author_url</span> .<span style="color:#a11">'" target="_blank" rel="external nofollow" title="'</span> . <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author</span> . <span style="color:#a11">' ('</span>. <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">cnt</span> . <span style="color:#a11">'条评论) | '</span>.<span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author_url</span>.<span style="color:#a11">'"&gt;'</span>.<span style="color:#@cm-word">get_avatar</span>( <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author_email</span>, <span style="color:#164">40</span> ) .  <span style="color:#a11">' &lt;/a&gt;&lt;/li&gt;'</span>;<br />					<span style="color:#708">endforeach</span>; <br />				<span style="color:#708">endif</span>;<br />			<span style="color:#555">?&gt;</span><br />		<span style="color:#170">&lt;/div</span><span style="color:#170">&gt;</span>	<span style="color:#a50">&lt;!-- end 读者墙 --&gt;</span></pre>

<span style = "color:blue;">然后新建页面（如叫：读者墙），选择模版为 Readers。</span>

参考CSS代码：

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444"><span style="color:#a50">/*读者墙代码*/</span><br />.<span style="color:#170">readers</span>{<span style="color:#000">margin-top</span>: <span style="color:#164">20px</span>;}<br />.<span style="color:#170">readers</span> <span style="color:#170">li</span>{<span style="color:#000">float</span>:<span style="color:#164">left</span>;<span style="color:#000">overflow</span>:<span style="color:#164">hidden</span>;<span style="color:#000">height</span>:<span style="color:#164">36px</span>;<span style="color:#000">margin-bottom</span>:<span style="color:#164">10px</span>;<span style="color:#000">line-height</span>:<span style="color:#164">18px</span>;<span style="color:#000">padding-bottom</span>:<span style="color:#164">10px</span>;<span style="color:#000">list-style</span>: <span style="color:#164">none</span>;}<br />.<span style="color:#170">readers</span> <span style="color:#170">img</span>{<span style="color:#000">float</span>:<span style="color:#164">left</span>;<span style="color:#000">border-radius</span>:<span style="color:#164">2px</span>;<span style="color:#000">margin-right</span>:<span style="color:#164">8px</span>;<span style="color:#000">width</span>:<span style="color:#164">36px</span>;<span style="color:#000">height</span>:<span style="color:#164">36px</span>;<span style="color:#000">padding</span>: <span style="color:#164">3px</span>;<span style="color:#000">border</span>: <span style="color:#164">1px</span> <span style="color:#164">solid</span> <span style="color:#219">#C9C9C9</span>;<span style="color:#000">background</span>: <span style="color:#219">#fff</span>;}</pre>

<span style = "color:red;">效果图：</span>

<img src="http://cyhour.com/wp-content/uploads/2012/10/readerswall-20141124.png" alt="readerswall-20141124" class="aligncenter size-full wp-image-1330" />

<span style = "color:red;">原版：</span>所谓刚子 - http://cgrabbit.info/typecho-and-wordpress-reader-wall.html

> Wordpress版本：（把下面的代码放在你想放的位置或者页面）
> 
> <pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444"><span style="color:#a50">&lt;!-- start 读者墙  Edited By cgrabbit--&gt;</span>   <br /><span style="color:#555">&lt;?php</span>     <br /> <span style="color:#000-2">$identity</span><span style="color:#000">=</span><span style="color:#a11">"comment_author"</span>;   <br /> <span style="color:#000-2">$passwordpost</span> <span style="color:#000">=</span> <span style="color:#a11">" AND post_password=''"</span>;   <br /> <span style="color:#000-2">$userexclude</span> <span style="color:#000">=</span> <span style="color:#a11">" AND user_id='0'"</span>;   <br /> <span style="color:#000-2">$approved</span> <span style="color:#000">=</span> <span style="color:#a11">" AND comment_approved='1'"</span>;   <br /> <span style="color:#000-2">$interval</span> <span style="color:#000">=</span> <span style="color:#164">30</span>;<span style="color:#a50">//表示一年一个轮回，数字表示轮回的天数   </span><br /> <span style="color:#000-2">$shownumber</span> <span style="color:#000">=</span> <span style="color:#164">20</span>;<span style="color:#a50">//表示在页面显示的数量   </span><br /> <span style="color:#000-2">$counts</span> <span style="color:#000">=</span> <span style="color:#000-2">$wpdb</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">get_results</span>(<span style="color:#a11">"SELECT COUNT("</span> . <span style="color:#000-2">$identity</span> . <span style="color:#a11">") AS cnt, comment_author, comment_author_url,comment_author_email  </span><br />  <span style="color:#a11">FROM (SELECT * FROM $wpdb-&gt;comments LEFT OUTER JOIN $wpdb-&gt;posts  </span><br /> <span style="color:#a11">ON ($wpdb-&gt;posts.ID=$wpdb-&gt;comments.comment_post_ID)  </span><br /> <span style="color:#a11">WHERE MONTH(comment_date)=MONTH(now()) and YEAR(comment_date)=YEAR(now())"</span> .   <br />  <span style="color:#000-2">$userexclude</span> . <span style="color:#000-2">$passwordpost</span> . <span style="color:#000-2">$approved</span> . <span style="color:#a11">") AS tempcmt  </span><br /> <span style="color:#a11">GROUP BY "</span> . <span style="color:#000-2">$identity</span> . <span style="color:#a11">" ORDER BY cnt DESC LIMIT "</span> . <span style="color:#000-2">$shownumber</span>); <span style="color:#555">?&gt;</span>     <br /><span style="color:#170">&lt;h3</span><span style="color:#170">&gt;</span>读者墙<span style="color:#170">&lt;/h3</span><span style="color:#170">&gt;</span>   <br />    <span style="color:#170">&lt;div</span> <span style="color:#00c">class</span>=<span style="color:#a11">"readers"</span><span style="color:#170">&gt;</span>   <br /><span style="color:#555">&lt;?php</span> <span style="color:#708">if</span> ( <span style="color:#000-2">$counts</span> ) : <span style="color:#708">foreach</span> (<span style="color:#000-2">$counts</span> <span style="color:#708">as</span> <span style="color:#000-2">$count</span>) :   <br /><span style="color:#708">echo</span>  <span style="color:#a11">'&lt;li&gt;'</span> .<span style="color:#@cm-word">get_avatar</span>(<span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author_email</span>,<span style="color:#164">48</span>). <span style="color:#a11">'&lt;a href="'</span>. <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author_url</span> .  <br /><span style="color:#a11">'" target="_blank" title="'</span> . <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author</span> . <span style="color:#a11">' ('</span>. <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">cnt</span> . <span style="color:#a11">'条评论)"&gt;'</span>. <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">comment_author</span> . <span style="color:#a11">'&lt;/a&gt;&lt;br&gt;&lt;strong&gt;'</span>. <span style="color:#000-2">$count</span><span style="color:#000">-&gt;</span><span style="color:#@cm-word">cnt</span> .<span style="color:#a11">'条&lt;/strong&gt;&lt;/li&gt;'</span>;   <br /> <span style="color:#708">endforeach</span>; <span style="color:#708">endif</span>;   <br /><span style="color:#555">?&gt;</span>   <br /> <span style="color:#170">&lt;/div</span><span style="color:#170">&gt;</span>   <br /><span style="color:#a50">&lt;!-- end 读者墙 --&gt;</span>      </pre>
> 
> 参考CSS样式
> 
> <pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444"><span style="color:#a50">/*读者墙代码*/</span>  <br />.<span style="color:#170">readers</span>{<span style="color:#000">margin-top</span>: <span style="color:#164">20px</span>;}   <br />.<span style="color:#170">readers</span> <span style="color:#170">li</span>{<span style="color:#000">float</span>:<span style="color:#164">left</span>;<span style="color:#000">width</span>:<span style="color:#164">25%</span>;<span style="color:#000">overflow</span>:<span style="color:#164">hidden</span>;<span style="color:#000">height</span>:<span style="color:#164">36px</span>;<span style="color:#000">margin-bottom</span>:<span style="color:#164">10px</span>;<span style="color:#000">line-height</span>:<span style="color:#164">18px</span>;<span style="color:#000">padding-bottom</span>:<span style="color:#164">10px</span>;<span style="color:#000">list-style</span>: <span style="color:#164">none</span>;}   <br />.<span style="color:#170">readers</span> <span style="color:#170">img</span>{<span style="color:#000">float</span>:<span style="color:#164">left</span>;<span style="color:#000">border-radius</span>:<span style="color:#164">2px</span>;<span style="color:#000">margin-right</span>:<span style="color:#164">8px</span>;<span style="color:#000">width</span>:<span style="color:#164">36px</span>;<span style="color:#000">height</span>:<span style="color:#164">36px</span>;<span style="color:#000">padding</span>: <span style="color:#164">3px</span>;<span style="color:#000">border</span>: <span style="color:#164">1px</span> <span style="color:#164">solid</span> <span style="color:#219">#C9C9C9</span>;<span style="color:#000">background</span>: <span style="color:#219">#fff</span>;}   <br />.<span style="color:#170">readers</span> <span style="color:#170">a</span>{<span style="color:#000">color</span>:<span style="color:#219">#666</span>;<span style="color:#000">border-bottom</span>: <span style="color:#164">none</span>;}   <br />.<span style="color:#170">readers</span> <span style="color:#170">a</span>:<span style="color:#170">hover</span>{<span style="color:#000">color</span>:<span style="color:#219">#333</span>;}   <br />.<span style="color:#170">readers</span> <span style="color:#170">strong</span>{<span style="color:#000">color</span>:<span style="color:#219">#380</span>;<span style="color:#000">font-weight</span>:<span style="color:#164">normal</span>;<span style="color:#000">line-height</span>: <span style="color:#164">33px</span>;} </pre>
> 
> 效果图如下：
> 
> <img src="http://cyhour.com/wp-content/uploads/2012/10/readerswall-suoweigangzi.png" alt="readerswall-suoweigangzi"  class="aligncenter size-full wp-image-1329" />