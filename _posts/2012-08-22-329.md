---
title: 返回顶部（进度环效果）
author: 大肥羊
layout: post
permalink: /329.html
categories:
  - 大肥羊转载
tags:
  - wordpress
---
大致原理就是根据滚动距离和文档高度排定滚动百分比然后绘制画布，百分比数字是用data储存并使用css的 content属性，结合Canvas实现。  


### 实现方法

确保引入了jquery,下面的代码加入到你的js文件中

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444"><span style="color:#708">var</span> <span style="color:#000">bigfa_scroll</span> = {<br />    <span style="color:#000">drawCircle</span>: <span style="color:#708">function</span>(<span style="color:#00f">id</span>, <span style="color:#00f">percentage</span>, <span style="color:#00f">color</span>) {<br />        <span style="color:#708">var</span> <span style="color:#00f">width</span> = <span style="color:#000">jQuery</span>(<span style="color:#000-2">id</span>).<span style="color:#000">width</span>();<br />        <span style="color:#708">var</span> <span style="color:#00f">height</span> = <span style="color:#000">jQuery</span>(<span style="color:#000-2">id</span>).<span style="color:#000">height</span>();<br />        <span style="color:#708">var</span> <span style="color:#00f">radius</span> = <span style="color:#000">parseInt</span>(<span style="color:#000-2">width</span> / <span style="color:#164">2.20</span>);<br />        <span style="color:#708">var</span> <span style="color:#00f">position</span> = <span style="color:#000-2">width</span>;<br />        <span style="color:#708">var</span> <span style="color:#00f">positionBy2</span> = <span style="color:#000-2">position</span> / <span style="color:#164">2</span>;<br />        <span style="color:#708">var</span> <span style="color:#00f">bg</span> = <span style="color:#000">jQuery</span>(<span style="color:#000-2">id</span>)[<span style="color:#164"></span>];<br />        <span style="color:#000-2">id</span> = <span style="color:#000-2">id</span>.<span style="color:#000">split</span>(<span style="color:#a11">"#"</span>);<br />        <span style="color:#708">var</span> <span style="color:#00f">ctx</span> = <span style="color:#000-2">bg</span>.<span style="color:#000">getContext</span>(<span style="color:#a11">"2d"</span>);<br />        <span style="color:#708">var</span> <span style="color:#00f">imd</span> = <span style="color:#219">null</span>;<br />        <span style="color:#708">var</span> <span style="color:#00f">circ</span> = <span style="color:#000">Math</span>.<span style="color:#000">PI</span> * <span style="color:#164">2</span>;<br />        <span style="color:#708">var</span> <span style="color:#00f">quart</span> = <span style="color:#000">Math</span>.<span style="color:#000">PI</span> / <span style="color:#164">2</span>;<br />        <span style="color:#000-2">ctx</span>.<span style="color:#000">clearRect</span>(<span style="color:#164"></span>, <span style="color:#164"></span>, <span style="color:#000-2">width</span>, <span style="color:#000-2">height</span>);<br />        <span style="color:#000-2">ctx</span>.<span style="color:#000">beginPath</span>();<br />        <span style="color:#000-2">ctx</span>.<span style="color:#000">strokeStyle</span> = <span style="color:#000-2">color</span>;<br />        <span style="color:#000-2">ctx</span>.<span style="color:#000">lineCap</span> = <span style="color:#a11">"square"</span>;<br />        <span style="color:#000-2">ctx</span>.<span style="color:#000">closePath</span>();<br />        <span style="color:#000-2">ctx</span>.<span style="color:#000">fill</span>();<br />        <span style="color:#000-2">ctx</span>.<span style="color:#000">lineWidth</span> = <span style="color:#164">3</span>;<br />        <span style="color:#000-2">imd</span> = <span style="color:#000-2">ctx</span>.<span style="color:#000">getImageData</span>(<span style="color:#164"></span>, <span style="color:#164"></span>, <span style="color:#000-2">position</span>, <span style="color:#000-2">position</span>);<br />        <span style="color:#708">var</span> <span style="color:#00f">draw</span> = <span style="color:#708">function</span>(<span style="color:#00f">current</span>, <span style="color:#00f">ctxPass</span>) {<br />            <span style="color:#000-2">ctxPass</span>.<span style="color:#000">putImageData</span>(<span style="color:#000-2">imd</span>, <span style="color:#164"></span>, <span style="color:#164"></span>);<br />            <span style="color:#000-2">ctxPass</span>.<span style="color:#000">beginPath</span>();<br />            <span style="color:#000-2">ctxPass</span>.<span style="color:#000">arc</span>(<span style="color:#000-2">positionBy2</span>, <span style="color:#000-2">positionBy2</span>, <span style="color:#000-2">radius</span>, -(<span style="color:#000-2">quart</span>), ((<span style="color:#000-2">circ</span>) * <span style="color:#000-2">current</span>) - <span style="color:#000-2">quart</span>, <span style="color:#219">false</span>);<br />            <span style="color:#000-2">ctxPass</span>.<span style="color:#000">stroke</span>();<br />        }<br />        <span style="color:#000-2">draw</span>(<span style="color:#000-2">percentage</span> / <span style="color:#164">100</span>, <span style="color:#000-2">ctx</span>);<br />    },<br />    <span style="color:#000">backToTop</span>: <span style="color:#708">function</span>(<span style="color:#00f">$this</span>) {<br />        <span style="color:#000-2">$this</span>.<span style="color:#000">click</span>(<span style="color:#708">function</span>() {<br />            <span style="color:#000">jQuery</span>(<span style="color:#a11">"body,html"</span>).<span style="color:#000">animate</span>({<br />                <span style="color:#000">scrollTop</span>: <span style="color:#164"></span><br />            },<br />            <span style="color:#164">800</span>);<br />            <span style="color:#708">return</span> <span style="color:#219">false</span>;<br />        });<br />    },<br />    <span style="color:#000">scrollHook</span>: <span style="color:#708">function</span>(<span style="color:#00f">$this</span>, <span style="color:#00f">color</span>) {<br />        <span style="color:#000-2">color</span> = <span style="color:#000-2">color</span> ? <span style="color:#000-2">color</span>: <span style="color:#a11">"#000000"</span>;<br />        <span style="color:#000-2">$this</span>.<span style="color:#000">scroll</span>(<span style="color:#708">function</span>() {<br />            <span style="color:#708">var</span> <span style="color:#00f">docHeight</span> = (<span style="color:#000">jQuery</span>(<span style="color:#000">document</span>).<span style="color:#000">height</span>() - <span style="color:#000">jQuery</span>(<span style="color:#000">window</span>).<span style="color:#000">height</span>()),<br />            <span style="color:#00f">$windowObj</span> = <span style="color:#000-2">$this</span>,<br />            <span style="color:#00f">$per</span> = <span style="color:#000">jQuery</span>(<span style="color:#a11">".per"</span>),<br />            <span style="color:#00f">percentage</span> = <span style="color:#164"></span>;<br />            <span style="color:#000">defaultScroll</span> = <span style="color:#000-2">$windowObj</span>.<span style="color:#000">scrollTop</span>();<br />            <span style="color:#000-2">percentage</span> = <span style="color:#000">parseInt</span>((<span style="color:#000">defaultScroll</span> / <span style="color:#000-2">docHeight</span>) * <span style="color:#164">100</span>);<br />            <span style="color:#708">var</span> <span style="color:#00f">backToTop</span> = <span style="color:#000">jQuery</span>(<span style="color:#a11">"#backtoTop"</span>);<br />            <span style="color:#708">if</span> (<span style="color:#000-2">backToTop</span>.<span style="color:#000">length</span> &gt; <span style="color:#164"></span>) {<br />                <span style="color:#708">if</span> (<span style="color:#000-2">$windowObj</span>.<span style="color:#000">scrollTop</span>() &gt; <span style="color:#164">200</span>) {<br />                    <span style="color:#000-2">backToTop</span>.<span style="color:#000">addClass</span>(<span style="color:#a11">"button--show"</span>);<br />                } <span style="color:#708">else</span> {<br />                    <span style="color:#000-2">backToTop</span>.<span style="color:#000">removeClass</span>(<span style="color:#a11">"button--show"</span>);<br />                }<br />                <span style="color:#000-2">$per</span>.<span style="color:#000">attr</span>(<span style="color:#a11">"data-percent"</span>, <span style="color:#000-2">percentage</span>);<br />                <span style="color:#000">bigfa_scroll</span>.<span style="color:#000">drawCircle</span>(<span style="color:#a11">"#backtoTopCanvas"</span>, <span style="color:#000-2">percentage</span>, <span style="color:#000-2">color</span>);<br />            }<br /><br />        });<br />    }<br />}<br /><br /><span style="color:#000">jQuery</span>(<span style="color:#000">document</span>).<span style="color:#000">ready</span>(<span style="color:#708">function</span>() {<br />    <span style="color:#000">jQuery</span>(<span style="color:#a11">"body"</span>).<span style="color:#000">append</span>(<span style="color:#a11">'&lt;div id="backtoTop" data-action="gototop"&gt;&lt;canvas id="backtoTopCanvas" width="48" height="48"&gt;&lt;/canvas&gt;&lt;div class="per"&gt;&lt;/div&gt;&lt;/div&gt;'</span>);<br />    <span style="color:#708">var</span> <span style="color:#00f">T</span> = <span style="color:#000">bigfa_scroll</span>;<br />    <span style="color:#000-2">T</span>.<span style="color:#000">backToTop</span>(<span style="color:#000">jQuery</span>(<span style="color:#a11">"#backtoTop"</span>));<br />    <span style="color:#000-2">T</span>.<span style="color:#000">scrollHook</span>(<span style="color:#000">jQuery</span>(<span style="color:#000">window</span>), <span style="color:#a11">"#cc0000"</span>);<br />});</pre>

### 参考css代码

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444"><span style="color:#219">#backtoTop</span>{<span style="color:#000">background-color</span>:<span style="color:#219">#eee</span>;<span style="color:#000">border-radius</span>:<span style="color:#164">100%</span>;<span style="color:#000">bottom</span>:<span style="color:#164">10%</span>;<span style="color:#000">height</span>:<span style="color:#164">48px</span>;<span style="color:#000">position</span>:<span style="color:#164">fixed</span>;<span style="color:#000">right</span>:<span style="color:#164">-100px</span>;<span style="color:#000">width</span>:<span style="color:#164">48px</span>;<span style="color:#000">transition</span>:<span style="color:#164">0.5s</span>;<span style="color:#000">-webkit-transition</span>:<span style="color:#164">0.5s</span>}<br /><span style="color:#219">#backtoTop</span>.<span style="color:#170">button--show</span>{<span style="color:#000">right</span>:<span style="color:#164">10px</span>}<br />.<span style="color:#170">per</span>{<span style="color:#000">font-size</span>:<span style="color:#164">16px</span>;<span style="color:#000">height</span>:<span style="color:#164">48px</span>;<span style="color:#000">line-height</span>:<span style="color:#164">48px</span>;<span style="color:#000">position</span>:<span style="color:#164">absolute</span>;<span style="color:#000">text-align</span>:<span style="color:#164">center</span>;<span style="color:#000">top</span>:<span style="color:#164"></span>;<span style="color:#000">width</span>:<span style="color:#164">48px</span>;<span style="color:#000">color</span>:<span style="color:#219">#555</span>;<span style="color:#000">cursor</span>:<span style="color:#164">pointer</span>}<br />.<span style="color:#170">per</span>:<span style="color:#170">before</span>{<span style="color:#000">content</span>:<span style="color:#164">attr</span><span style="color:#164">(data-percent</span><span style="color:#164">)</span>}<br />.<span style="color:#170">per</span>:<span style="color:#170">hover</span>:<span style="color:#170">before</span>{<span style="color:#000">content</span>:<span style="color:#a11">"↑"</span>;<span style="color:#000">font-size</span>:<span style="color:#164">20px</span>}</pre>

修改进度环颜色，则修改<span style = "color:blue;">T.scrollHook(jQuery(window,'#000000'));</span>的颜色参数即可，默认黑色。

### 为啥我的图标不一样

我使用了字体图标，如果你也使用了字体图标，则把content内容换成你的图标并加上font-family即可。

via 大发 ：http://fatesinger.com/74271