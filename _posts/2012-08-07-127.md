---
title: WordPress 按分类排序的文章归档
author: 大肥羊
layout: post
permalink: /127.html
categories:
  - 大肥羊转载
tags:
  - wordpress
---
上次写的时光轴归档流传范围之广远超我的想象，但是已经因为某些原因西去了，自从恢复博客我也没新建归档页面，恰好看见z大写了写的归档，琢磨着自己也写一个，考虑到按照时间的已经没什么可折腾的了索性写了个按照分类的。

感受地址 <a href="http://fatesinger.com/archive" target="_blank">http://fatesinger.com/archive</a>  


### 说明

  * 我使用了CSS 隐藏了部分文章(<a href="http://fatesinger.com/73799" target="_blank">参考文章</a>)，使每个分类只显示5篇文章，当然hover 的时候会全部显示
  * 函数自带一个hide_empty参数，是否隐藏没有文章的分类

### 实现方法

下面的代码加入到functions.php中

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444">function get_archive_by_category($hide_empty = false){<br />    $output = '<span style="color:#170">&lt;div</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-groups"</span><span style="color:#170">&gt;</span>';<br />    $cateargs = array(<br />        'hide_empty' =&gt; $hide_empty<br />    );<br />    $categories = get_categories($cateargs);<br />    foreach($categories as $category) {<br />        $output .= '<span style="color:#170">&lt;div</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-group"</span><span style="color:#170">&gt;</span><span style="color:#170">&lt;h2</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-title"</span><span style="color:#170">&gt;</span><span style="color:#170">&lt;a</span> <span style="color:#00c">href</span>=<span style="color:#a11">"' . get_category_link( $category-&gt;term_id ) . '"</span> <span style="color:#00c">title</span>=<span style="color:#a11">"' . $category-&gt;name . '"</span> <span style="color:#a11">' . '</span><span style="color:#170">&gt;</span>' . $category-&gt;name.'<span style="color:#170">&lt;/a</span><span style="color:#170">&gt;</span> <span style="color:#170">&lt;/h2</span><span style="color:#170">&gt;</span><span style="color:#170">&lt;h3</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-description"</span><span style="color:#170">&gt;</span>'. $category-&gt;description . '<span style="color:#170">&lt;/h3</span><span style="color:#170">&gt;</span><span style="color:#170">&lt;div</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-postcount v-textAlignCenter"</span><span style="color:#170">&gt;</span>'. $category-&gt;count . '<span style="color:#170">&lt;/div</span><span style="color:#170">&gt;</span>';<br />        $args = array(<br />            'category' =&gt; $category-&gt;term_id,<br />            'numberposts' =&gt; -1<br />        );<br />        $output .= '<span style="color:#170">&lt;div</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-posts"</span><span style="color:#170">&gt;</span>';<br />        $posts = get_posts($args);<br />        foreach($posts as $post){<br />            $output .= '<span style="color:#170">&lt;div</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-post"</span><span style="color:#170">&gt;</span><span style="color:#170">&lt;a</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-post-title"</span> <span style="color:#00c">href</span>=<span style="color:#a11">"'.get_permalink($post-&gt;ID).'"</span><span style="color:#170">&gt;</span>'.$post-&gt;post_title.'<span style="color:#170">&lt;/a</span><span style="color:#170">&gt;</span><span style="color:#170">&lt;time</span> <span style="color:#00c">class</span>=<span style="color:#a11">"archive-category-post-time"</span><span style="color:#170">&gt;</span>'.human_time_diff(strtotime($post-&gt;post_date_gmt),time()).' ago <span style="color:#170">&lt;/time</span><span style="color:#170">&gt;</span><span style="color:#170">&lt;/div</span><span style="color:#170">&gt;</span>';<br />        }<br />        $output .= '<span style="color:#170">&lt;/div</span><span style="color:#170">&gt;</span><span style="color:#170">&lt;/div</span><span style="color:#170">&gt;</span>';<br />    }<br />    return $output;<br /><br />}<br />function archive_by_category_shortcode($atts, $content=null){<br />    extract( shortcode_atts( array(<br />            'hide_empty' =&gt; false,<br />        ),<br />        $atts ) );<br />    return get_archive_by_category($hide_empty);<br />}<br />add_shortcode('archivebc','archive_by_category_shortcode');</pre>

css代码

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444">.<span style="color:#170">archive-category-groups</span> {<br />	<span style="color:#000">margin</span>:<span style="color:#164">20px</span> <span style="color:#164"></span><br />}<br />.<span style="color:#170">archive-category-groups</span>:<span style="color:#170">after</span> {<br />	<span style="color:#000">content</span>:<span style="color:#a11">"Code by bigfa"</span>;<br />	<span style="color:#000">display</span>:<span style="color:#164">block</span>;<br />	<span style="color:#000">text-align</span>:<span style="color:#164">right</span>;<br />	<span style="color:#000">font-style</span>:<span style="color:#164">italic</span>;<br />	<span style="color:#000">color</span>:<span style="color:#164">rgba</span><span style="color:#164">(0</span>,<span style="color:#164"></span>,<span style="color:#164"></span>,<span style="color:#164">0.6</span><span style="color:#164">)</span>;<br />	<span style="color:#000">margin-top</span>:<span style="color:#164">10px</span>;<br />	<span style="color:#000">font-size</span>:<span style="color:#164">12px</span>;<br />}<br />.<span style="color:#170">archive-category-title</span> {<br />	<span style="color:#000">font-size</span>:<span style="color:#164">22px</span>;<br />	<span style="color:#000">margin-top</span>:<span style="color:#164">20px</span><br />}<br />.<span style="color:#170">archive-category-postcount</span> {<br />	<span style="color:#000">height</span>:<span style="color:#164">41px</span>;<br />	<span style="color:#000">width</span>:<span style="color:#164">41px</span>;<br />	<span style="color:#000">background-color</span>:<span style="color:#219">#eee</span>;<br />	<span style="color:#000">border-radius</span>:<span style="color:#164">100%</span>;<br />	<span style="color:#000">font-family</span>:<span style="color:#164">fatesinger</span>;<br />	<span style="color:#000">line-height</span>:<span style="color:#164">40px</span><br />}<br />.<span style="color:#170">archive-category-posts</span> {<br />	<span style="color:#000">border-left</span>:<span style="color:#164">1px</span> <span style="color:#219">#eee</span> <span style="color:#164">solid</span>;<br />	<span style="color:#000">margin-left</span>:<span style="color:#164">20px</span>;<br />	<span style="color:#000">padding</span>:<span style="color:#164">20px</span>;<br />	<span style="color:#000">position</span>:<span style="color:#164">relative</span>;<br />}<br />.<span style="color:#170">archive-category-posts</span>:<span style="color:#170">after</span> {<br />	<span style="color:#000">background-color</span>:<span style="color:#219">#eee</span>;<br />	<span style="color:#000">border-radius</span>:<span style="color:#164">100%</span>;<br />	<span style="color:#000">content</span>:<span style="color:#a11">""</span>;<br />	<span style="color:#000">height</span>:<span style="color:#164">9px</span>;<br />	<span style="color:#000">left</span>:<span style="color:#164">-5px</span>;<br />	<span style="color:#000">position</span>:<span style="color:#164">absolute</span>;<br />	<span style="color:#000">bottom</span>:<span style="color:#164">0px</span>;<br />	<span style="color:#000">width</span>:<span style="color:#164">9px</span>;<br />}<br />.<span style="color:#170">archive-category-post</span> {<br />	<span style="color:#000">margin</span>:<span style="color:#164">5px</span>;<br />	<span style="color:#000">position</span>:<span style="color:#164">relative</span><br />}<br />.<span style="color:#170">archive-category-post</span>:<span style="color:#170">before</span> {<br />	<span style="color:#000">background-color</span>:<span style="color:#219">#eee</span>;<br />	<span style="color:#000">border-radius</span>:<span style="color:#164">100%</span>;<br />	<span style="color:#000">content</span>:<span style="color:#a11">""</span>;<br />	<span style="color:#000">height</span>:<span style="color:#164">7px</span>;<br />	<span style="color:#000">left</span>:<span style="color:#164">-29px</span>;<br />	<span style="color:#000">position</span>:<span style="color:#164">absolute</span>;<br />	<span style="color:#000">top</span>:<span style="color:#164">10px</span>;<br />	<span style="color:#000">width</span>:<span style="color:#164">7px</span>;<br />}<br />.<span style="color:#170">archive-category-post</span>:<span style="color:#170">nth-child</span><span style="color:#170">(n</span>+<span style="color:#164">6</span><span style="color:#170">)</span>{<br />	<span style="color:#000">display</span>:<span style="color:#164">none</span><br />}<br />.<span style="color:#170">archive-category-group</span>:<span style="color:#170">hover</span> .<span style="color:#170">archive-category-post</span>:<span style="color:#170">nth-child</span><span style="color:#170">(n</span>+<span style="color:#164">5</span><span style="color:#170">)</span>{<br />	<span style="color:#000">display</span>:<span style="color:#164">block</span><br />}<br />.<span style="color:#170">archive-category-post-title</span>:<span style="color:#170">hover</span> {<br />	<span style="color:#000">color</span>:<span style="color:#219">#c80f32</span><br />}<br />.<span style="color:#170">archive-category-post-time</span> {<br />	<span style="color:#000">font-size</span>:<span style="color:#164">12px</span>;<br />	<span style="color:#000">font-style</span>:<span style="color:#164">italic</span>;<br />	<span style="color:#000">margin-left</span>:<span style="color:#164">5px</span>;<br />	<span style="color:#000">color</span>:<span style="color:#164">rgba</span><span style="color:#164">(0</span>,<span style="color:#164"></span>,<span style="color:#164"></span>,<span style="color:#164">0.6</span><span style="color:#164">)</span><br />}<br />.<span style="color:#170">archive-category-description</span> {<br />	<span style="color:#000">color</span>:<span style="color:#164">rgba</span><span style="color:#164">(0</span>,<span style="color:#164"></span>,<span style="color:#164"></span>,<span style="color:#164">0.6</span><span style="color:#164">)</span>;<br />	<span style="color:#000">margin-bottom</span>:<span style="color:#164">10px</span><br />}<br />.<span style="color:#170">archive-category-description</span>:<span style="color:#170">before</span> {<br />	<span style="color:#000">display</span>:<span style="color:#164">block</span>;<br />	<span style="color:#000">width</span>:<span style="color:#164">30%</span>;<br />	<span style="color:#000">height</span>:<span style="color:#164">1px</span>;<br />	<span style="color:#000">background-color</span>:<span style="color:#219">#eee</span>;<br />	<span style="color:#000">margin</span>:<span style="color:#164">10px</span> <span style="color:#164"></span>;<br />	<span style="color:#000">content</span>:<span style="color:#a11">""</span><br />}</pre>

### 使用方法

新建页面，添加短代码<span style = "color:red;">[archivebc hide_empty = 0]</span>即可

如果和你的样式发生了冲突也可以采用<span style = "color:red;"><?php echo get_archive_by_category(true); ?></span>来调用自定义页面。

via Fatesinger : <a href="http://fatesinger.com/73788" target="_blank">http://fatesinger.com/73788</a>