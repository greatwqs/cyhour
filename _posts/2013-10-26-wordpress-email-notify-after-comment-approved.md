---
title: WordPress评论通过审核后邮件通知评论者
author: 大肥羊
layout: post
permalink: /wordpress-email-notify-after-comment-approved.html
categories:
  - 信息技术
tags:
  - wordpress
  - 邮件通知
---
RT，评论通过审核后，给评论者发送一封通知邮件。  


在当前主题的functions.php中添加以下PHP代码：

<pre style="margin:15px 0;font:100 12px/18px monaco, andale mono, courier new;padding:10px 12px;border:#ccc 1px solid;border-left-width:4px;background-color:#fefefe;box-shadow:0 0 4px #eee;word-break:break-all;word-wrap:break-word;color:#444">//评论通过后邮件通知  <br />add_action('comment_unapproved_to_approved', 'cy_comment_approved');  <br />function cy_comment_approved($comment) {  <br />      if(is_email($comment-&gt;comment_author_email)) {  <br />        $wp_email = 'no-reply@' . preg_replace('#^www.#', '', strtolower($_SERVER['SERVER_NAME'])); // e-mail 發出點, no-reply 可改為可用的 e-mail.  <br />        $subject = '您在 [' . get_option("blogname") . '] 的评论已通过审核';  <br />        $message = '  <br />            <span style="color:#170">&lt;table</span> <span style="color:#00c">style</span>=<span style="color:#a11">"width: 99.8%;height:99.8% "</span><span style="color:#170">&gt;</span>  <br />                <span style="color:#170">&lt;tbody</span><span style="color:#170">&gt;</span>  <br />                    <span style="color:#170">&lt;tr</span><span style="color:#170">&gt;</span>  <br />                        <span style="color:#170">&lt;td</span> <span style="color:#00c">style</span>=<span style="color:#a11">"background:#FFF"</span><span style="color:#170">&gt;</span>  <br />                            <span style="color:#170">&lt;div</span> <span style="color:#00c">style</span>=<span style="color:#a11">"background-color:white;border-top:3px solid #000;box-shadow:0 2px 2px #000;line-padding:0 15px 14px;width:600px;margin:20px auto;color:#000;font-family:Century Gothic,Trebuchet MS,Hiragino Sans GB,微软雅黑,Microsoft Yahei,Tahoma,Helvetica,Arial,SimSun,sans-serif;font-size:14px;"</span><span style="color:#170">&gt;</span>  <br />                                <span style="color:#170">&lt;h2</span> <span style="color:#00c">style</span>=<span style="color:#a11">"border-bottom:1px solid #888;font-size:16px;font-weight:blod;padding:5px 0 20px 10px;"</span><span style="color:#170">&gt;</span>  <br />                                    您在 『<span style="color:#170">&lt;a</span> <span style="color:#00c">style</span>=<span style="color:#a11">"text-decoration:none;color: #12ADDB;"</span> <span style="color:#00c">href</span>=<span style="color:#a11">"' . get_option('home') . '"</span><span style="color:#170">&gt;</span>' . get_option('blogname') . ' <span style="color:#170">&lt;/a</span><span style="color:#170">&gt;</span>』博客上的评论已通过审核啦！  <br />                                <span style="color:#170">&lt;/h2</span><span style="color:#170">&gt;</span>  <br />                                <span style="color:#170">&lt;div</span> <span style="color:#00c">style</span>=<span style="color:#a11">"padding:0 12px 0 12px;margin-top:18px"</span><span style="color:#170">&gt;</span>  <br />                                    <span style="color:#170">&lt;p</span><span style="color:#170">&gt;</span>  <br />                                        <span style="color:#170">&lt;b</span><span style="color:#170">&gt;</span>' . trim($comment-&gt;comment_author) . ' <span style="color:#170">&lt;/b</span><span style="color:#170">&gt;</span>君，您曾在文章『' . get_the_title($comment-&gt;comment_post_ID) . '』上发表评论:  <br />                                    <span style="color:#170">&lt;/p</span><span style="color:#170">&gt;</span>  <br />                                    <span style="color:#170">&lt;p</span> <span style="color:#00c">style</span>=<span style="color:#a11">"background-color: #ddd;border: 1px solid #888;padding: 10px 10px;margin:10px 0"</span><span style="color:#170">&gt;</span>  <br />                                        ' . nl2br($comment-&gt;comment_content) . '  <br />                                    <span style="color:#170">&lt;/p</span><span style="color:#170">&gt;</span>  <br />                                    <span style="color:#170">&lt;p</span><span style="color:#170">&gt;</span>  <br />                                        已通过管理员审核并显示。  <br />                                    <span style="color:#170">&lt;/p</span><span style="color:#170">&gt;</span>  <br />                                    <span style="color:#170">&lt;p</span> <span style="color:#00c">style</span>=<span style="color:#a11">"padding: 10px 10px;margin:20px 0"</span><span style="color:#170">&gt;</span>  <br />                                        您可以：<span style="color:#170">&lt;a</span> <span style="color:#00c">style</span>=<span style="color:#a11">"text-decoration:none; color:#12addb"</span> <span style="color:#00c">href</span>=<span style="color:#a11">"' . htmlspecialchars(get_comment_link($comment-&gt;comment_ID)) . '"</span><span style="color:#170">&gt;</span>前往查看您的完整评论內容<span style="color:#170">&lt;/a</span><span style="color:#170">&gt;</span>！  <br />                                        欢迎再次光临<span style="color:#170">&lt;a</span> <span style="color:#00c">style</span>=<span style="color:#a11">"text-decoration:none; color:#12addb"</span> <span style="color:#00c">href</span>=<span style="color:#a11">"' . get_option('home') . '"</span><span style="color:#170">&gt;</span>' . get_option('blogname') . '<span style="color:#170">&lt;/a</span><span style="color:#170">&gt;</span>！  <br />                                    <span style="color:#170">&lt;/p</span><span style="color:#170">&gt;</span>  <br />                                <span style="color:#170">&lt;/div</span><span style="color:#170">&gt;</span>  <br />                            <span style="color:#170">&lt;/div</span><span style="color:#170">&gt;</span>  <br />                        <span style="color:#170">&lt;/td</span><span style="color:#170">&gt;</span>  <br />                    <span style="color:#170">&lt;/tr</span><span style="color:#170">&gt;</span>  <br />                <span style="color:#170">&lt;/tbody</span><span style="color:#170">&gt;</span>  <br />            <span style="color:#170">&lt;/table</span><span style="color:#170">&gt;</span>';  <br />            // 这行代码会转换评论中使用的表情  <br />        $message = convert_smilies($message);   <br />        $from = "From: "" . get_option('blogname') . "" <span style="color:#170">&lt;$wp_email</span><span style="color:#170">&gt;</span>";  <br />        $headers = "$fromnContent-Type: text/html; charset=" . get_option('blog_charset') . "n";  <br />        wp_mail( $comment-&gt;comment_author_email, $subject, $message, $headers );       <br />      }  <br />}  </pre>

最后用UTF-8、无BOM编码另存，替换原来的functions.php就可以了。

效果图：

![wordpress-email-notify-after-comment-approved][1]

<p style="text-align: right;">
  ——修改自 露兜 http://www.ludou.org/wordpress-email-notify-after-comment-approved.html
</p>

 [1]: https://cyhour.com/wp-content/uploads/2013/11/wordpress-email-notify-after-comment-approved.jpg